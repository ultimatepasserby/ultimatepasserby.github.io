<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Python网络爬虫学习笔记</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Python网络爬虫学习笔记" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Python网络爬虫学习笔记" />
<meta property="og:description" content="Python网络爬虫学习笔记" />
<link rel="canonical" href="http://localhost:4000/blog/python/2021/08/28/Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E4%B8%8E%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0.html" />
<meta property="og:url" content="http://localhost:4000/blog/python/2021/08/28/Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E4%B8%8E%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-28T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Python网络爬虫学习笔记" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-08-28T00:00:00+08:00","datePublished":"2021-08-28T00:00:00+08:00","description":"Python网络爬虫学习笔记","headline":"Python网络爬虫学习笔记","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/python/2021/08/28/Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E4%B8%8E%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0.html"},"url":"http://localhost:4000/blog/python/2021/08/28/Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E4%B8%8E%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/blog/feed.xml" /></head>
<body><a href="/" class="home-link">返回简历主页</a>
<!-- 确保自定义样式被加载 -->
<link rel="stylesheet" href="/blog/assets/css/main.scss"><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Python网络爬虫学习笔记</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-08-28T00:00:00+08:00" itemprop="datePublished">Aug 28, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="python网络爬虫学习笔记">Python网络爬虫学习笔记</h1>

<h2 id="一网络数据采集概述">一、网络数据采集概述</h2>

<h3 id="1-爬虫基本概念">1. 爬虫基本概念</h3>
<ul>
  <li><strong>定义</strong>：爬虫（crawler）也叫网络蜘蛛（spider），是按一定规则自动浏览网站并获取信息的机器人程序。</li>
  <li><strong>工作原理</strong>：通过网页超链接不断获取其他页面地址，实现数据采集。</li>
</ul>

<h3 id="2-应用领域">2. 应用领域</h3>
<ul>
  <li>搜索引擎、新闻聚合、社交应用、舆情监控、行业数据等。</li>
</ul>

<h3 id="3-合法性探讨">3. 合法性探讨</h3>
<ul>
  <li><strong>Robots协议</strong>：网站定义的<code class="language-plaintext highlighter-rouge">robots.txt</code>文件，是君子协议，非强制。</li>
  <li><strong>合法要点</strong>：
    <ul>
      <li>只爬取前端公开数据，不碰后台敏感信息。</li>
      <li>遵守Robots协议，控制抓取速度。</li>
      <li>尊重网站知识产权，不破坏服务器。</li>
      <li>隐匿身份，不公开爬虫代码。</li>
    </ul>
  </li>
</ul>

<h3 id="4-http协议基础">4. HTTP协议基础</h3>
<ul>
  <li><strong>请求组成</strong>：请求行、请求头、空行、消息体。</li>
  <li><strong>响应组成</strong>：响应行、响应头、空行、消息体。</li>
  <li><strong>常用状态码</strong>：
    <ul>
      <li>200 OK：请求成功。</li>
      <li>404 Not Found：页面未找到。</li>
      <li>500 Internal Server Error：服务器内部错误。</li>
    </ul>
  </li>
</ul>

<h3 id="5-开发工具">5. 开发工具</h3>
<ul>
  <li><strong>Chrome Developer Tools</strong>：查看页面元素、网络请求等。</li>
  <li><strong>Postman</strong>：模拟HTTP请求，调试接口。</li>
  <li><strong>HTTPie</strong>：命令行HTTP客户端。</li>
  <li><strong>builtwith</strong>：识别网站技术栈。</li>
  <li><strong>python-whois</strong>：查询网站所有者信息。</li>
</ul>

<h3 id="6-爬虫基本流程">6. 爬虫基本流程</h3>
<ol>
  <li>设定抓取目标并获取网页。</li>
  <li>处理服务器无法访问的情况。</li>
  <li>设置用户代理或隐藏IP。</li>
  <li>解码页面并提取信息。</li>
  <li>提取页面链接。</li>
  <li>处理链接并重复抓取。</li>
  <li>持久化有用信息。</li>
</ol>

<h2 id="二用python获取网络资源">二、用Python获取网络资源</h2>

<h3 id="1-requests库">1. requests库</h3>
<ul>
  <li><strong>基本用法</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">https://www.sohu.com/</span><span class="sh">'</span><span class="p">)</span>
<span class="k">if</span> <span class="n">resp</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># 获取HTML文本
</span></code></pre></div>    </div>
  </li>
  <li><strong>获取二进制资源</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">图片URL</span><span class="sh">'</span><span class="p">)</span>
<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">filename.png</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li><strong>设置请求头</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6)...</span><span class="sh">'</span><span class="p">}</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-编写爬虫示例豆瓣电影top250">2. 编写爬虫示例（豆瓣电影Top250）</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="s">https://movie.douban.com/top250?start=</span><span class="si">{</span><span class="p">(</span><span class="n">page</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">25</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">BaiduSpider</span><span class="sh">'</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># 提取电影标题和评分
</span>    <span class="n">titles</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">&lt;span class=</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="s">&gt;([^&amp;]*?)&lt;/span&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">&lt;span class=</span><span class="sh">"</span><span class="s">rating_num</span><span class="sh">"</span><span class="s">.*?&gt;(.*?)&lt;/span&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">ranks</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">rank</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 随机休眠，避免频繁请求
</span></code></pre></div></div>

<h3 id="3-使用ip代理">3. 使用IP代理</h3>
<ul>
  <li><strong>作用</strong>：隐匿爬虫身份，避免IP被封。</li>
  <li><strong>示例（蘑菇代理）</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="n">APP_KEY</span> <span class="o">=</span> <span class="sh">'</span><span class="s">你的AppKey</span><span class="sh">'</span>
<span class="n">PROXY_HOST</span> <span class="o">=</span> <span class="sh">'</span><span class="s">secondtransfer.moguproxy.com:9001</span><span class="sh">'</span>
  
<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
    <span class="n">url</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">Proxy-Authorization</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Basic </span><span class="si">{</span><span class="n">APP_KEY</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0...</span><span class="sh">'</span>
    <span class="p">},</span>
    <span class="n">proxies</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">http</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">http://</span><span class="si">{</span><span class="n">PROXY_HOST</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">https</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">https://</span><span class="si">{</span><span class="n">PROXY_HOST</span><span class="si">}</span><span class="sh">'</span>
    <span class="p">},</span>
    <span class="n">verify</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="三用python解析html页面">三、用Python解析HTML页面</h2>

<h3 id="1-html页面结构">1. HTML页面结构</h3>
<ul>
  <li><strong>基本结构</strong>：
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="c">&lt;!-- 元信息 --&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="c">&lt;!-- 页面主体 --&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-解析方法对比">2. 解析方法对比</h3>

<table>
  <thead>
    <tr>
      <th>解析方式</th>
      <th>模块</th>
      <th>速度</th>
      <th>使用难度</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>正则表达式</td>
      <td>re</td>
      <td>快</td>
      <td>困难</td>
    </tr>
    <tr>
      <td>XPath</td>
      <td>lxml</td>
      <td>快</td>
      <td>一般</td>
    </tr>
    <tr>
      <td>CSS选择器</td>
      <td>bs4/pyquery</td>
      <td>不确定</td>
      <td>简单</td>
    </tr>
  </tbody>
</table>

<h3 id="3-xpath解析">3. XPath解析</h3>
<ul>
  <li><strong>安装</strong>：<code class="language-plaintext highlighter-rouge">pip install lxml</code></li>
  <li><strong>示例</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="nc">HTML</span><span class="p">(</span><span class="n">html_text</span><span class="p">)</span>
<span class="c1"># 提取电影标题
</span><span class="n">titles</span> <span class="o">=</span> <span class="n">tree</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="sh">'</span><span class="s">//*[@id=</span><span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="s">]/div/div[1]/ol/li/div/div[2]/div[1]/a/span[1]/text()</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="4-css选择器解析beautifulsoup">4. CSS选择器解析（BeautifulSoup）</h3>
<ul>
  <li><strong>安装</strong>：<code class="language-plaintext highlighter-rouge">pip install beautifulsoup4</code></li>
  <li><strong>示例</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">bs4</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">bs4</span><span class="p">.</span><span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">html_text</span><span class="p">,</span> <span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># 提取电影标题
</span><span class="n">titles</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">'</span><span class="s">div.info &gt; div.hd &gt; a &gt; span:nth-child(1)</span><span class="sh">'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">title</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="四python并发编程在爬虫中的应用">四、Python并发编程在爬虫中的应用</h2>

<h3 id="1-多线程编程">1. 多线程编程</h3>
<ul>
  <li><strong>优点</strong>：适合I/O密集型任务，提升程序效率。</li>
  <li><strong>示例（下载文件）</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">import</span> <span class="n">time</span>
  
<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">开始下载 </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 模拟下载耗时
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s"> 下载完成</span><span class="sh">'</span><span class="p">)</span>
  
<span class="c1"># 创建并启动线程
</span><span class="n">threads</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nc">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">download</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="sh">'</span><span class="s">文件1</span><span class="sh">'</span><span class="p">,)),</span>
    <span class="nc">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">download</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="sh">'</span><span class="s">文件2</span><span class="sh">'</span><span class="p">,))</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>  <span class="c1"># 等待线程结束
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="2-多进程编程">2. 多进程编程</h3>
<ul>
  <li><strong>优点</strong>：突破GIL限制，适合计算密集型任务。</li>
  <li><strong>示例（进程池）</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>
  
<span class="k">def</span> <span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="c1"># 判断质数的逻辑
</span>    <span class="k">pass</span>
  
<span class="k">with</span> <span class="nc">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">is_prime</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="3-异步io编程">3. 异步I/O编程</h3>
<ul>
  <li><strong>优点</strong>：高效处理大量I/O操作，减少线程开销。</li>
  <li><strong>示例（aiohttp爬取网页）</strong>：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">import</span> <span class="n">aiohttp</span>
  
<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="p">.</span><span class="nc">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resp</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">resp</span><span class="p">.</span><span class="nf">text</span><span class="p">()</span>
  
<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">https://python.org</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">https://jd.com</span><span class="sh">'</span><span class="p">,</span> <span class="p">...]</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="nf">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span>  <span class="c1"># 打印前100字
</span>  
<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="4-三种方式对比">4. 三种方式对比</h3>
<ul>
  <li><strong>单线程</strong>：简单，但效率低，适合小规模任务。</li>
  <li><strong>多线程</strong>：适合I/O密集型，提升效率，但有线程切换开销。</li>
  <li><strong>异步I/O</strong>：高效处理大量并发I/O，代码更简洁，推荐用于爬虫。</li>
</ul>

<h2 id="五使用selenium抓取动态内容">五、使用Selenium抓取动态内容</h2>

<h3 id="1-selenium简介">1. Selenium简介</h3>
<ul>
  <li><strong>作用</strong>：驱动浏览器获取动态渲染的页面内容。</li>
  <li><strong>安装</strong>：<code class="language-plaintext highlighter-rouge">pip install selenium</code></li>
  <li><strong>驱动下载</strong>：根据Chrome版本下载对应ChromeDriver。</li>
</ul>

<h3 id="2-基本用法">2. 基本用法</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="c1"># 创建浏览器对象
</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="nc">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">https://www.baidu.com</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># 查找元素并操作
</span><span class="n">input_elem</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="nf">find_element_by_id</span><span class="p">(</span><span class="sh">'</span><span class="s">kw</span><span class="sh">'</span><span class="p">)</span>
<span class="n">input_elem</span><span class="p">.</span><span class="nf">send_keys</span><span class="p">(</span><span class="sh">'</span><span class="s">Python</span><span class="sh">'</span><span class="p">)</span>
<span class="n">button_elem</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="nf">find_element_by_id</span><span class="p">(</span><span class="sh">'</span><span class="s">su</span><span class="sh">'</span><span class="p">)</span>
<span class="n">button_elem</span><span class="p">.</span><span class="nf">click</span><span class="p">()</span>

<span class="c1"># 等待元素加载
</span><span class="kn">from</span> <span class="n">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="n">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="n">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>

<span class="n">wait</span> <span class="o">=</span> <span class="nc">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">element</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="nf">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="nf">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="sh">'</span><span class="s">content_left</span><span class="sh">'</span><span class="p">)))</span>

<span class="c1"># 执行JavaScript
</span><span class="n">browser</span><span class="p">.</span><span class="nf">execute_script</span><span class="p">(</span><span class="sh">'</span><span class="s">window.scrollTo(0, document.body.scrollHeight)</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># 无头模式
</span><span class="n">options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="nc">ChromeOptions</span><span class="p">()</span>
<span class="n">options</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--headless</span><span class="sh">'</span><span class="p">)</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="nc">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="六爬虫框架scrapy简介">六、爬虫框架Scrapy简介</h2>

<h3 id="1-scrapy概述">1. Scrapy概述</h3>
<ul>
  <li><strong>优点</strong>：模块化设计，提高爬虫开发效率。</li>
  <li><strong>核心组件</strong>：
    <ul>
      <li>引擎（Engine）：控制数据流程。</li>
      <li>调度器（Scheduler）：管理请求队列。</li>
      <li>下载器（Downloader）：下载网页。</li>
      <li>蜘蛛（Spiders）：解析页面，提取数据。</li>
      <li>数据管道（Item Pipeline）：处理和存储数据。</li>
      <li>中间件（Middlewares）：扩展框架功能。</li>
    </ul>
  </li>
</ul>

<h3 id="2-快速入门">2. 快速入门</h3>
<ul>
  <li><strong>创建项目</strong>：<code class="language-plaintext highlighter-rouge">scrapy startproject demo</code></li>
  <li><strong>创建蜘蛛</strong>：<code class="language-plaintext highlighter-rouge">cd demo &amp;&amp; scrapy genspider douban movie.douban.com</code></li>
  <li><strong>定义Item</strong>（<code class="language-plaintext highlighter-rouge">items.py</code>）：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">scrapy</span>
<span class="k">class</span> <span class="nc">DoubanItem</span><span class="p">(</span><span class="n">scrapy</span><span class="p">.</span><span class="n">Item</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="nc">Field</span><span class="p">()</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="nc">Field</span><span class="p">()</span>
    <span class="n">motto</span> <span class="o">=</span> <span class="n">scrapy</span><span class="p">.</span><span class="nc">Field</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li><strong>编写蜘蛛</strong>（<code class="language-plaintext highlighter-rouge">spiders/douban.py</code>）：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">scrapy</span>
<span class="k">class</span> <span class="nc">DoubanSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="p">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">'</span><span class="s">douban</span><span class="sh">'</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">movie.douban.com</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">https://movie.douban.com/top250</span><span class="sh">'</span><span class="p">]</span>
      
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">movie</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="sh">'</span><span class="s">#content &gt; div &gt; div.article &gt; ol &gt; li</span><span class="sh">'</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">title</span><span class="sh">'</span><span class="p">:</span> <span class="n">movie</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="sh">'</span><span class="s">.title::text</span><span class="sh">'</span><span class="p">).</span><span class="nf">get</span><span class="p">(),</span>
                <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="n">movie</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="sh">'</span><span class="s">.rating_num::text</span><span class="sh">'</span><span class="p">).</span><span class="nf">get</span><span class="p">(),</span>
                <span class="sh">'</span><span class="s">motto</span><span class="sh">'</span><span class="p">:</span> <span class="n">movie</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="sh">'</span><span class="s">.inq::text</span><span class="sh">'</span><span class="p">).</span><span class="nf">get</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">yield</span> <span class="n">item</span>
        <span class="c1"># 处理翻页
</span>        <span class="n">next_page</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="sh">'</span><span class="s">.paginator .next a::attr(href)</span><span class="sh">'</span><span class="p">).</span><span class="nf">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">next_page</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">response</span><span class="p">.</span><span class="nf">follow</span><span class="p">(</span><span class="n">next_page</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">parse</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li><strong>运行爬虫</strong>：<code class="language-plaintext highlighter-rouge">scrapy crawl douban -o result.json</code></li>
</ul>

<h3 id="3-数据管道pipelinespy">3. 数据管道（<code class="language-plaintext highlighter-rouge">pipelines.py</code>）</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DoubanPipeline</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">spider</span><span class="p">):</span>
        <span class="c1"># 数据处理逻辑，如保存到数据库
</span>        <span class="k">return</span> <span class="n">item</span>
</code></pre></div></div>

<h3 id="4-配置settingspy">4. 配置（<code class="language-plaintext highlighter-rouge">settings.py</code>）</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">USER_AGENT</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36</span><span class="sh">'</span>
<span class="n">CONCURRENT_REQUESTS</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">DOWNLOAD_DELAY</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">demo.pipelines.DoubanPipeline</span><span class="sh">'</span><span class="p">:</span> <span class="mi">300</span><span class="p">}</span>
</code></pre></div></div>

<h2 id="七总结">七、总结</h2>
<ul>
  <li><strong>爬虫开发流程</strong>：确定目标→分析网站→选择工具→编写代码→处理反爬→存储数据。</li>
  <li><strong>反爬应对</strong>：设置请求头、控制抓取频率、使用IP代理、模拟浏览器行为。</li>
  <li><strong>框架选择</strong>：简单任务用requests+解析库，复杂任务用Scrapy框架。</li>
</ul>

  </div><a class="u-url" href="/blog/python/2021/08/28/Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E4%B8%8E%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name"></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
